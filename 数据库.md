### Innodb 引擎



#### InnoDB数据页结构

页是InnoDB管理存储空间的基本单位，一个页的大小一般是16KB。

存储数据记录的页，官方称为索引页。



页中按照主键大小正序串联成了一个单链表。

因此mysql使用了Page Directory（页目录），来实现对主键的查找。：将所有记录分为几组，将各组的偏移量取出存在Page Directory。

1. **通过二分法确定该记录所在的槽，并找到该槽所在分组中主键值最小的那条记录。**
2. **通过记录的next_record属性遍历该槽所在的组中的各个记录。**



#### B+树索引

B+树索引并不能找到一个给定键值的具体行。B+树索引能找到的只是被查找数据行所在的页。然后数据库通过把页读入到内存，再在内存中进行查找，最后得到要查找的数据。

聚集索引就是按照每张表的主键构造一颗B+树，同时叶子节点中存放的即为整张表的行记录数据，也将聚集索引的叶子节点称为数据页。

对于辅助索引，叶子节点并不包含行记录的全部数据。叶子节点除了包含键值以外，每个叶子节点中的索引行中还包含一个书签。该书签用来告诉InnoDB存储引擎哪里可以找到与索引相对应的行数据。



#### ACID

原子性：一组语句要么全执行，要么全不执行。

​				基于日志系统的redo,undo机制。

一致性：事务不会破坏数据库的完整性约束

隔离性：同一时间，只允许一个事务请求同一数据，不同的事务之间彼此没有任何干扰；

持久性：事务完成后，数据库不能回滚。



#### InnoDB存储引擎由内存池和一些后台线程组成

**内存池主要工作**

- 维护所有进程/线程需要访问的多个内部数据结构
- 缓存磁盘上的数据，方便快速读取，同时在对磁盘文件修改之前进行缓存
- 缓存重做日志（redo log）

**后台线程主要工作**

- 刷新内存池中的数据，保证缓冲池中缓存的数据最新
- 将已修改数据文件刷新到磁盘文件
- 保证数据库异常时InnoDB能恢复到正常运行状态



#### InnoDB重要特性

MySQL InnoDB通过如下重要特性实现了更好的新能和更高的特性

- 插入缓冲（insert buffer）
- 两次写（Double write）
- 自适应哈希索引（adaptive hash index）
- 异步io（Async IO）
- 刷新领接页（Flush Neighbor Page）